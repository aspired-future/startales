<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story TTS Test - Hollywood Voice</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #ffffff;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .story-event {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #00d4ff;
        }
        .play-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        .play-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .play-button.playing {
            background: linear-gradient(45deg, #ff4757, #c44569);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }
        .voice-info {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
        }
        .narration-text {
            font-style: italic;
            line-height: 1.6;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        h2 {
            color: #ff6b6b;
            border-bottom: 2px solid rgba(255, 107, 107, 0.3);
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Story TTS Test - Hollywood Voice</h1>
        <p>Testing the enhanced TTS system with cinematic, Hollywood-style voices (no robotic voices).</p>
        
        <div class="voice-info" id="voiceInfo">
            <strong>üé§ Voice Selection:</strong> Loading available voices...
        </div>

        <div class="story-event">
            <h2>üåå The Awakening Signal</h2>
            <div class="narration-text" id="narration1">
                "Deep in the cosmic void, ancient signals pierce the darkness. Something that has slept for millennia is awakening. The very fabric of space trembles with anticipation as your civilization stands on the precipice of discovery."
            </div>
            <button class="play-button" onclick="playNarration(1)">üé≠ Play Narration</button>
            <button class="play-button" onclick="stopNarration()">‚èπÔ∏è Stop</button>
        </div>

        <div class="story-event">
            <h2>üöÄ The Diplomatic Overture</h2>
            <div class="narration-text" id="narration2">
                "The stars themselves seem to hold their breath as graceful vessels of unknown design glide through the void. Their message echoes across space and time: 'We come bearing gifts of knowledge and warnings of what lies ahead.' The fate of your civilization hangs in the balance of this first contact."
            </div>
            <button class="play-button" onclick="playNarration(2)">üé≠ Play Narration</button>
            <button class="play-button" onclick="stopNarration()">‚èπÔ∏è Stop</button>
        </div>

        <div class="story-event">
            <h2>üïµÔ∏è The Shadow Conspiracy</h2>
            <div class="narration-text" id="narration3">
                "In the shadows of power, betrayal festers like a cancer. Your most trusted advisors may harbor dark secrets. The enemy may already be within your walls. Trust no one. Question everything. For the very soul of your civilization is at stake."
            </div>
            <button class="play-button" onclick="playNarration(3)">üé≠ Play Narration</button>
            <button class="play-button" onclick="stopNarration()">‚èπÔ∏è Stop</button>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let currentButton = null;

        // Process dramatic text for TTS
        function processDramaticText(text) {
            let processedText = text
                .replace(/\[.*?\]/g, '') // Remove [stage directions]
                .replace(/\*.*?\*/g, '') // Remove *stage directions*
                .replace(/\.\.\./g, '... ') // Add space after ellipsis for natural pauses
                .replace(/\s+/g, ' ') // Normalize whitespace
                .trim();
            
            // Add natural pauses for dramatic effect
            processedText = processedText
                .replace(/\./g, '. ') // Pause after sentences
                .replace(/,/g, ', ') // Slight pause after commas
                .replace(/;/g, '; ') // Pause after semicolons
                .replace(/:/g, ': ') // Pause after colons
                .replace(/\?/g, '? ') // Pause after questions
                .replace(/!/g, '! '); // Pause after exclamations
            
            return processedText;
        }

        // Select cinematic voice
        function selectCinematicVoice() {
            const voices = speechSynthesis.getVoices();
            console.log('üé¨ Available voices:', voices.map(v => `${v.name} (${v.lang})`));
            
            // Priority order for cinematic, Hollywood-style voices (avoid robotic ones)
            const cinematicVoice = voices.find(voice => 
                // Prefer natural, expressive voices
                voice.name.includes('Daniel') ||     // macOS - rich, natural voice
                voice.name.includes('Samantha') ||   // macOS - expressive female voice
                voice.name.includes('Alex') ||       // macOS - natural male voice
                voice.name.includes('Victoria') ||   // Windows - expressive female
                voice.name.includes('David') ||      // Windows - natural male
                voice.name.includes('Zira') ||       // Windows - clear female
                voice.name.includes('Mark') ||       // Windows - natural male
                voice.name.includes('Hazel') ||      // Natural British accent
                voice.name.includes('Karen') ||      // Natural Australian accent
                voice.name.includes('Moira') ||      // Natural Irish accent
                voice.name.includes('Tessa')         // Natural South African accent
            ) || voices.find(voice => 
                // Fallback: any natural-sounding English voice (avoid Microsoft voices that sound robotic)
                voice.lang.startsWith('en') && 
                !voice.name.toLowerCase().includes('microsoft') &&
                !voice.name.toLowerCase().includes('cortana') &&
                !voice.name.toLowerCase().includes('speech')
            ) || voices.find(voice => 
                // Last resort: any English voice
                voice.lang.startsWith('en-US') || voice.lang.startsWith('en-GB')
            ) || voices[0]; // Final fallback
            
            return cinematicVoice;
        }

        // Update voice info display
        function updateVoiceInfo() {
            const voice = selectCinematicVoice();
            const voiceInfo = document.getElementById('voiceInfo');
            if (voice) {
                voiceInfo.innerHTML = `<strong>üé§ Selected Voice:</strong> ${voice.name} (${voice.lang}) - Natural, cinematic quality`;
            } else {
                voiceInfo.innerHTML = `<strong>üé§ Voice:</strong> Default system voice`;
            }
        }

        // Play narration
        function playNarration(id) {
            stopNarration(); // Stop any current narration
            
            const narrationElement = document.getElementById(`narration${id}`);
            const text = narrationElement.textContent.replace(/"/g, '');
            const processedText = processDramaticText(text);
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(processedText);
                
                // Configure voice for Hollywood cinematic effect
                utterance.rate = 0.75; // Slightly slower for cinematic gravitas
                utterance.pitch = 0.85; // Rich, authoritative pitch
                utterance.volume = 1.0; // Full volume for impact
                
                const cinematicVoice = selectCinematicVoice();
                if (cinematicVoice) {
                    utterance.voice = cinematicVoice;
                    console.log('üé¨ Using voice:', cinematicVoice.name);
                }

                // Find the button that was clicked
                currentButton = event.target;
                currentButton.textContent = 'üé≠ Playing...';
                currentButton.classList.add('playing');

                utterance.onstart = () => {
                    console.log('üé¨ Starting cinematic narration');
                };

                utterance.onend = () => {
                    console.log('üé¨ Narration complete');
                    if (currentButton) {
                        currentButton.textContent = 'üé≠ Play Narration';
                        currentButton.classList.remove('playing');
                    }
                    currentSpeech = null;
                    currentButton = null;
                };

                utterance.onerror = (error) => {
                    console.error('üé¨ TTS Error:', error);
                    if (currentButton) {
                        currentButton.textContent = 'üé≠ Play Narration';
                        currentButton.classList.remove('playing');
                    }
                    currentSpeech = null;
                    currentButton = null;
                };

                currentSpeech = utterance;
                speechSynthesis.speak(utterance);
            } else {
                alert('üé¨ Speech synthesis not supported. Please use a modern browser for the full cinematic experience.');
            }
        }

        // Stop narration
        function stopNarration() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                if (currentButton) {
                    currentButton.textContent = 'üé≠ Play Narration';
                    currentButton.classList.remove('playing');
                }
                currentSpeech = null;
                currentButton = null;
            }
        }

        // Initialize when voices are loaded
        if (speechSynthesis.getVoices().length > 0) {
            updateVoiceInfo();
        } else {
            speechSynthesis.onvoiceschanged = updateVoiceInfo;
        }
    </script>
</body>
</html>
